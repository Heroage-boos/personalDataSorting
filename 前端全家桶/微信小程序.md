##### 小程序注册

​       百度搜索微信公众号，找官网，进入点击小程序进行注册，一个账号只能注册一种类型的媒体，所以不能注册成其他成小程序之外的

​		1.一个邮箱只有一个appid，只能注册一个小程序

​		2.一个人名下可以有5个小程序	

​		3.个体商户可以拥有10个小程序

​		4.企业，政府可以注册50个小程序



##### 开发小程序储备知识

 	-开发小程序不需要考虑兼容性问题

​	 -极力推荐小程序布局flex

​	-移动端相关知识

​        -像素:

​		   -物理像素真实存在

​		   -设备独立像素，设备出厂的时候就已经存在

​	       -横向上面1个设备独立像素点等于1个物理像素点

​		   -位图像素:

​		    -css像素:

​       -视口:-布局视口，视觉视口都是真实存在的视口

​						-布局视口:相当于整个html，绘制所有的内容，实指html元素

​						-视觉视口:能够所有能看到的屏幕大小中的内容，实值手机屏幕

​				-完美视口:不真实存在的视口，布局视口和完美视口一样大被称为完美视口，是一种状态(实现方式:通过meta[name=viewport]标签实现修改布局视口大小)

​        -适配:适配就是让一套样式，在多种大小的手机上，显示效果相近



##### 小程序特点

​	1.没有DOM

​    2.组件化开发

​	3.体积小，单个压缩体积不能超过2m,否则不能上线

​	4.重要文件 *.js  *.wxml 结构 *.wxss 样式   *.json配置文件

​	5.小程序适配方案:rpx   在ipone6下面:1rpx=1物理像素=0.5css

​			-规定屏幕宽度为750rpx（屏幕350等分的rem）

​			-1rpx= 375/750 =0.5px(css像素)=1物理像素

​		    -rpx是基于rem的适配，rem是基于html宽度

​    

创建小程序项目:

​	 1.小程序创建-->项目地址-->appId(微信公众号官网-->开发管理-->开发设置-->appId)-->开发模式(小程序，插件等同于代码片段)-->后端开发(不使用服务器,云开发需要收费的)--->语言(javascript)  -->创建成功

​			小游戏和小程序不是同一种类型的

​			代码片段:用来调试公众号的

​	 2.详情 -->调试基础库



##### 小程序基本文件目录

​	-sitemap.json 配置文件,可对整个小程序的页面索引进行关闭

​	-project.config.json  整个项目详细配置，对应  详情

​	-app.wxss  公共样式，所有组件要用的都可以写这里 相当于css，不过不能处理预处理器

​	-app.js   文件中APP(object object)的相当于new Vue({})

​	-app.json 整个项目的配置文件

​	-pages 静态样式  ->  index 首页



##### 小程序标签

   -view 相当于div

   -text  对应sapn

   -button 对应button

   

##### 小程序数据绑定

###### 	1.数据显示

​		 -1.声明状态数据:在data中提前声明状态数据

​		-2.显示状态数据:于vue相同，只需要在wxml中使用差值语法{{msg}}即可显示，小程序中会对data数据进行深拷贝

​	   -3.数据流向问题

​			 1.vue  -单向数据流  注意:v-model的叫做双向数据绑定(伪双向数据流)   原理: v-model-->数据代理-->this.$data-->数据劫持

​                -vue中数据更新时同步的，但视图的刷新是异步的

​			 2.react(状态持久化框架) -单向数据流，必须通过 this.setState({msg:"xxx"})才能动态改变view视图层数据

​			 3.小程序 -单向数据流，但是小程序没有数据劫持

​                 -{{msg}}                -data里面是个对象   data:{msg:"XXX"}

​			

######     2.数据修改

​      1.vue   

​               -1.通过v-model   ，this.data=data

​	   2.react(状态持久化框架)

​               必须通过 this.setState({msg:"xxx"})才能动态改变view视图层数据

​              1.setSate函数执行是同步还是异步的？ 同步执行

​			  2.setSate在各种情况下是同步还是异步的?

​					-原生事件，定时器    同步

​					-合成事件，生命周期   异步,

​									-

​	    3.小程序 

​				1.语法：this.setData({msg:"北鼻1"})

​				2.小程序中更新状态数据是同步更新，但是视图是异步渲染		-由于数据是同步更新的所以每次使用数据一定都是当前最新的

​				

######        3.数据读取

​				小程序:{{msg}}



##### WXML语法

​	 1.小程序事件分类

​		 -冒泡事件(类似原生中的冒泡阶段事件)

​			语法:bind+"事件名"=“回调函数名”

​		-非冒泡事件(绑定并阻止事件冒泡)

​			-语法:catch+"事件名"="回调函数名"

​            -也可以用 `catch` 来绑定事件。与 `bind` 不同， `catch` 会阻止事件向上冒泡。

​		-捕获事件

​			-语法:capture-bind+":"+"事件名"=“回调函数名"

​			-需要在捕获阶段监听事件时，可以采用`capture-bind`

​		-非捕获事件

​			-语法:capture-catch+":"+"事件名"="回调函数名"

​		    -将中断捕获阶段和取消冒泡阶段。



#####  路由跳转

​	1.声明式导航

​		  1.通过navigator标签进行跳转

​    2.编程式跳转

​		 1.wx.navigateTo({})  (类似vue中的push)

​				-1.跳转到其他页面有一个回退按钮，会保留当前页面,实际保留的是当前页面的实例对象

​				-2.url必填 

​			    -3..会保留上一个页面，如果想要展示只需要取出之前页面进行展示

​		       **-4.小程序中页面栈最多10层**

​			   -5.如果小程序的页面中已经达到了上线，此时再次跳转，将无法正常跳转

​		   2.wx.redirectTo({})

​				-1.关闭当前页面，实际销毁的是当前页面的实例对象

​				-2.url必填 

​				-3.会销毁上一个页面，如果想要展示需要重新挂载

​						

​		3.注意:

​				-1.跳转路径可以写相对路径，参考当前路径

​				-2.跳转路径可以写绝对路径，参考当前项目根目录



​		4.获取友商的appid可以跳转到友商小程序,方法:

​			**wx.navigateBackMiniProgram(Object object)**



##### 小程序声明周期

​	1.小程序中共有5个生命周期

​	     1.进入

​				1.onLoad(页面加载)

​				2.onShow(页面显示)

​				3.onReady(页面初次渲染完成)

​					-mounted意思是挂载结束

​					-vue中的mounted想要达到同等效果还需要配合vue.$nextTick()

​		 2.离开

​				1.onHide(页面隐藏)

​				2.onUnload（页面卸载）

​	2.生命周期注意点

​		1.如果离开当前页面的时候，使用的是wx.navgateTo跳转

​			 -会保留当前页面，从而触发onHide生命周期，不会触发onUnload

​			-如果点击回退按钮，可以重新展示上一个页面，但是只会触发onShow生命周期

​		2.如果离开当前页面的时候，使用的是wx.redirectTo跳转

​			1.会关闭当前页面，从而触发onUnloade生命周期，不会触发onHide
​	    3.按照生命周期所示，

​		





##### 小程序重要功能

​	1.用户首次登录授权

​			1.目前一共有出现3中获取用户授权的方法，目前可行一种

​			2.授权方法如下:

​				1.早期

​				2.中期(21/4月中旬废弃)

​					-1.使用button组件并且添加属性 open-type="getUserInfo"，实现用户点击弹出授权功能

​					-2.需要获取到用户的授权信息

​						-1.通过给button标签绑定事件监听，事件名：getuseInfo

​						-2.可以在回调函数的形参中，获取用户的信息

​						-3.绑定给数据到data上面即可

​				3.最新

​					1.API.wx.getUserProfile

​					2.注意:
​						 1.问题:wx.getUserProfile is not a function

​						 2.解决:版本库2.15.0以上

​						 3.在onLoad中调用无效，这个方法必须在触发了tap事件之后，才允许调用

​						4.当前刷新后头像又没了，解决:将用户信息保存到本地服务器上面获取在线服务器上面



​	2.用户二次登录免授权(静默登录)

​			早期

​			 1.当用户进入改项目的时候

​					1.可以通过生命周期对用户的操作进行监视

​			2.尝试获取用户信息

​					1.在onLoad中使用wx.getUserInfo()获取用户信息

​					2.将信息保存到data中

​					3.注意:该功能只能实现用户首次登录的授权功能，需要配合二次登录免授权功能才能实现用户重新进入获取到信息



​	3.神奇的组件	

​			1.组件名称:open-data

​			2.功能:用于展示用户的部分基础信息

​			3.注意:该组件展示的内容，只能看不能用，对于开发者来说没用



##### 插件

1. **小程序插件使用**

   1. 前往fuwu.weixin.qq.com寻找自己想要的插件

   2. 进入插件详情页面,点击添加插件

   3. 进入微信公众平台后台,可以在设置->第三方设置

   4. 由于当前学习的插件是定位以及城市选择器,所以需要使用到定位功能

      1. 需要申请开启定位功能
         1. 微信公众平台后台->开发->开发工具,点击腾讯位置服务
         2. 扫码授权之后,会自动跳转到腾讯位置服务官网,点击进入控制台(第一次需要注册账号)
         3. 控制台->左侧导航->应用管理->我的应用中,添加新的key值

   5. 在小程序中引入插件

      1. 在app.json中添加一个plugins配置项,用于声明当前项目使用到的插件

         1. ```json
            {
              "plugins": {
               "citySelector": {
                 "version": "1.0.0",
                 "provider": "wx63ffb7b7894e99ae"
               }
             }
            }
            ```

            

      2. 在app.json中添加一个permission配置项,用于申请获取用户定位信息

         1. ```json
            {
              "permission": {
                "scope.userLocation": {
                  "desc": "你的位置信息将用于小程序定位"
                }
              }
            }
            ```

   6. 使用插件

      1. 通过某个按钮的点击事件,用于跳转到对应的插件页面

         1. ```javascript
                const key = 'BZ7BZ-QQWCU-DHWV2-BFJJG-B2JZF-KSBT3'; // 使用在腾讯位置服务申请的key
                const referer = '七月入栈'; // 调用插件的app的名称
                const hotCitys = '上海,北京,深圳,泉州'; // 用户自定义的的热门城市
            
                wx.navigateTo({
                  url: `plugin://citySelector/index?key=${key}&referer=${referer}&hotCitys=${hotCitys}`,
                })
            ```

      7.获取当前用户选择的城市信息

      ​	1.引入组件

      ```javascript
      const citySelector = requirePlugin('citySelector');
      ```

      ​	1.在当前页面的onShow中,调用该组件的getCity方法获取到用户的选择结果

      ```javascript
      const selectedCity = citySelector.getCity();
      ```
   
   3.强制更新(项目上线后才能使用)

​	前言:小程序的启动一共分为两种，分别是热启动和冷启动

​				**冷启动**:根据小程序机制，首次开启的时候后，小程序需要初始化渲染

​				**热启动**:根据小程序机制，如果用户离开当前小程序，不超过5分钟(期间用户的内存足够)，再从进入小程序，小程序会保持离开之前的状态，不会关闭

​	1.获取全局唯一的更新管理器实例----

```javascript
let updateManager = wx.getUpdateManager();
```

​	2.绑定checkforupdate事件监听

​		1.他会不断向微信官方服务器发送请求,检测当前小程序版本是否为最新版本

​		2.如果出现比本地更新的版本,会自动下载

```javascript
updateManager.onCheckForUpdate(function (res) {
      // 请求完新版本信息的回调
    //res中的hasUpdate可以知道是否需要更新
      if (res.hasUpdate) {
          //弹窗提示用户
      }
    })
```

​	3.绑定updateReady事件,监听小程序更新是否下载完成

```javascript
 updateManager.onUpdateReady(function () {
     //调用该API实现更新包安装,强制更新
     updateManager.applyUpdate()
    })
```

​	注意:一般来说不会姐姐调用updateManger.applyUpdate()/因为这个代码直接关闭小程序，并开始更新的安装操作，为了防止用户正在做默写大事，我们一般会友好的弹出窗口提示用户有最新版本，咨询是否更新



小程序发送请求

​	 1.小程序发送请求

​        1.API:wx.request({})

​		2.注意:

​				1.小程序中没有window,全局对象是wx,所以不能使用axios

​				2.小程序中没有代理服务器，可以直接请求目标服务器(所以可以直接使用服务器地址请求)	

​				3.小程序在上线的时候，必须具有https证书，否则无法请求

​				4.默认超时时间和最大超时时间都是60s

​				5.wx.request的最大并发限制是10个，Chrome和FireFox的并发限制6个

​						1.所有雪碧图能优化前后端性能

2.配置化相关

​	 1.上线时

​			1.小程序想要请求服务器，必须提前报备好需要请求的服务器地址

​			2.配置流程:打开小程序后台-->开发-->开发设置-->服务器域名配置

​	 2.开发时

​			1.小程序开发的时候，可以关闭小程序的请求域名校验功能

​			    1.流程:开发工具-->详情-->本地设置-->取消勾选-->不校验合法域名





小程序列表渲染

  	1.小程序列表渲染

​			1.语法

​					wx:for="{{data}}"  wx:key="id" 

​			2.wx:for对应vue中v-for

​			3.小程序中会自动将遍历出来的每一项的下标放在index变量中

​			4.改变变量数据的变量名:可以使用wx.for-item="新的变量名"

​			5.改变遍历下标名，使用wx:for-index="新的下标名"

​	

API

 wx.showToast({title})  弹窗提示

 路由跳转

​	wx.switchTab()  可以跳转tabBar页面，并关闭其他tabbar页面

​	wx.getStroage  存储到getSStroage

​     wx.getStroage  获取到getSStroage			

  项目整理

​		1推荐歌曲区域惊天样式

​			 1.多行文本溢出隐藏，并显示省略号

​					1.文本溢出隐藏 ovflowr:hidden

​					2.webkit盒模型:display:-webkit-box

​					3.要省略的行数:-webkit-line-alamp-  :2

​					4.改变省略方向:-webkit-box-orient:vertical

​	  点击登录功能

​				1.收集数据

​				2.前台表单验证

​				3.整理数据

​				4.成功做什么

​					1.收集信息

​					2.跳转

​					3.将用户信息保存到storage

​					4.

​				5.失败做什么

​		实现分享功能，一共有两种方法:

​			1.通过小程序右上角分享功能

​			2.通过button按钮

​     		触发弹窗功能效果有两个渠道，但是都会调用同一个函数

​			实现:1)根据用户触发渠道不同，自定义转发内容、

​					  2)如果是button按钮就转发当前视频名称+视频图片+页面路径

​						转发监听事件上传入from参数，可进行判断触发方式

​	             

​    小程序中的通信手段:

​			1.globaleData 

​			2.app实例

​			3.Storage(存放重要数据)

​			4.PubSub(类似于事件总线，可以实现订阅和发布，但它是npm包)

​						-1.订阅者($想要接受数据) $on("事件名",回调函数)

​						-2.发布者(想要发送数据) $emit('事件名'，发送数据)

​							注意:订阅必须在发布之前，否则接受不到数据

​	小程序中使用npm包:(举例PubSub)

​			1.使用cmd在当前路径下下载PubSubJS

​			2.勾选详情 -->npm模块

​			3.引入包

​			4.构建npm    选项栏-->工具-->构建npm



分包:

​    构建项目的时候打包成不同的分包，=主包和次包都不能超过2m

​    分包大小有限制:-整个小程序所有分包不超过20m

​								-单个分包/主包不能超过2m



​	普通分包:分包不分家，

​	独立分包:分包也分家，分包不能共享主包的资源

​	使用场景:1)普通分包:为了过审

​					2）临时添加的页面，比如活动页，过段时间不再使用



















​				



